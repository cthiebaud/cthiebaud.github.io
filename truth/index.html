<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truth Tables</title>
    <link href="./favicon.ico" rel="icon" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #e5dfc2;
            /* white; /* #e5dfc2 */
            color: #173F35;
            /* PANTONE 567 C (closest to Sherwood Green) */
        }

        .container>h1 {
            color: #173F35;
        }

        #tables>div {
            display: inline-block;
            border: lightgray 1px solid;
            margin: .25rem;
            padding: 0;
        }

        table.inline {
            display: inline-block;
            margin: 0;
        }

        table caption {
            white-space: nowrap;
            font-weight: bold;
            font-size: 18px;
            background-color: #FFFFFF40;
            margin-bottom: .5rem;
        }

        table th {
            text-align: center;
            vertical-align: middle;
            font-weight: normal;
            font-size: 12px;
            padding: 0;
            background-color: transparent !important;
        }

        table td {
            width: var(--cell-width);
            height: var(--cell-width);
            text-align: center;
            vertical-align: middle;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-size: larger;
            padding: 0;
        }

        .vertical-text {
            writing-mode: vertical-rl;
            /* Vertical writing mode, right to left */
            transform: rotate(180deg);
            /* Rotate the text 180 degrees */
        }

        .center-children {
            text-align: center;
        }
    </style>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap');
    </style>
    <script type="text/javascript" src="https://livejs.com/live.js"></script>
    <!-- 
    -->
</head>

<body>
    <div id="con" class="pt-3 container" style="visibility: hidden; max-width: 580px; padding:0;">
        <div class="btn-group float-end" role="group">
            <button id="AB" type="button" class="btn btn-light">AB</button>
            <button id="LF" type="button" class="btn btn-light">LF</button>
        </div>
        <h1 class="">(a, b) => &hellip;</h1>
        <div id="tables" class="font-monospace center-children"></div>
        <h1 class="text-center mt-3" style="font-family: 'UnifrakturCook', cursive; font-size: 72px;">Truth</h1>
    </div>
    <script type="module">
        import tinycolor from 'https://cdn.jsdelivr.net/npm/tinycolor2@latest/+esm'

        function setCellWidth(length) {
            let cellWidth = '56px'
            if (length === 3) {
                cellWidth = '52px'
            }
            document.documentElement.style.setProperty('--cell-width', cellWidth);
        }

        class AB {
            constructor() {
                setCellWidth(this.AB.length)
            }
            ABs = [[true, false], [null, true, false]]
            ABi = 0
            AB = this.ABs[this.ABi]
            bump() {
                this.ABi = (this.ABi + 1) % this.ABs.length
                this.AB = this.ABs[this.ABi]
                setCellWidth(this.AB.length)
            }
        }
        let ab = new AB()

        let lineBreaks = false // true // 


        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]
            }
            // console.log("shuffled!")
        }

        // document.getElementById("con").style.backgroundColor = '#fedcba'
        class Colors {
            constructor() {
                shuffleArray(this.colors)
            }

            colorFalse = 'transparent'
            colorTrue = '#545955'
            colors = [
                /*
                */
                '#F4F4F4',
                '#FAC80A',
                '#B40000',
                '#00852B',
                '#1E5AA8',
                '#8A928D',
                /*'#000000',*/
                '#ABD9FF',
                /*
                '#543324',
                '#545955',
                '#FF8014',
                '#BB805A',
                '#D86D2C',
                '#F2705E',
                '#FF879C',
                '#CCB98D',
                '#78FC78',
                '#CF8A47',
                '#FF9494',
                '#ADD9A8',
                '#FFF230',
                '#F6A9BB',
                '#FFD67F',
                '#7FC475',
                '#AFBED6',
                '#D05098',
                */
                '#91501C',
                /*
                '#58AB41',
                '#97CBD9',
                '#671FA1',
                '#DA8678',
                '#EDC4B5',
                */
            ]
            currentColorIndex = 0
            nextColor = function () {
                const currentColor = this.colors[this.currentColorIndex++]
                this.currentColorIndex %= this.colors.length
                // console.log(index, currentColorIndex)
                if (this.currentColorIndex === 0) {
                    shuffleArray(this.colors)
                }
                return currentColor
            }
        }

        const colors = new Colors()

        const functions = [
            'false',
            0,
            'a & b',
            'a & !b',
            '!a & !b',
            '!a & b',
            0,
            'a',
            'b',
            '!a',
            '!b',
            'a == b',
            'a != b',
            0,
            'a | b',
            'a | !b',
            '!a | !b',
            '!a | b',
            0,
            'true',
        ]
        if (!lineBreaks) {
            // shuffleArray(functions)
        }

        function doIt() {

            let previousElement = null
            functions.forEach((func, index) => {
                const elementID = `element${index}`
                if (func === 0) {
                    if (lineBreaks) {
                        previousElement.insertAdjacentHTML("afterend", `<br id="${elementID}" style="display: block;">`)
                        previousElement = document.getElementById(elementID)
                    }
                } else {
                    const theadID = `thead${index}`
                    const tbodyID = `tbody${index}`
                    const template = `<div id="${elementID}">
    <table class="table inline table-sm caption-top table-borderless">
        <caption class="text-center">${func}</caption>
        <thead id="${theadID}"></thead>
        <tbody id="${tbodyID}"></tbody>
    </table>
</div>
`
                    if (previousElement === null) {
                        document.getElementById('tables').innerHTML = template
                    } else {
                        previousElement.insertAdjacentHTML("afterend", template)
                    }
                    let backgroundcolor
                    if (func === 'false') {
                        backgroundcolor = colors.colorFalse
                    } else if (func === 'true') {
                        backgroundcolor = colors.colorTrue
                    } else {
                        backgroundcolor = colors.nextColor()
                    }
                    ab.AB.forEach((rowElem, indexRow) => {
                        const row = document.createElement("tr")
                        ab.AB.forEach(colElem => {
                            // console.log(index, func, rowElem, colElem)
                            const col = document.createElement(rowElem === null || colElem === null ? "th" : "td")
                            row.appendChild(col)
                            if (colElem === null) {
                                if (rowElem === null) {
                                    col.innerHTML = '&nbsp;'
                                } else {
                                    col.innerHTML = `<div class="vertical-text">${rowElem}</div>`
                                }
                            } else {
                                if (rowElem === null) {
                                    col.innerHTML = colElem
                                } else {
                                    const a = rowElem
                                    const b = colElem
                                    const result = eval(func)
                                    if (result) {
                                        col.style.backgroundColor = result ? backgroundcolor : colors.colorFalse
                                        col.style.color = tinycolor(col.style.backgroundColor).darken(3).toString("hex6")
                                        if ((func === "a == b" || func === "a != b") && indexRow === 0) {
                                            backgroundcolor = colors.nextColor()
                                        }
                                    } else {
                                        col.style.color = col.style.backgroundColor = colors.colorFalse
                                    }
                                    col.innerHTML = result ? '●' /* '○' */ : '&nbsp;'
                                }
                            }
                        })
                        document.getElementById(rowElem === null ? theadID : tbodyID).appendChild(row)
                    });
                    previousElement = document.getElementById(elementID)
                }
            });
        }

        window.addEventListener("load", loadEvent => {
            doIt();
            (conElement => {
                conElement.style.visibility = 'visible'
                conElement.addEventListener('click', clickEvent => {
                    shuffleArray(colors)
                    doIt()
                    /*
                    setInterval(() => {
                        doIt()
                    }, 1000);
                    */
                })
            })(document.getElementById("con"))

            document.getElementById("AB").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                ab.bump()
                doIt()
            })
            document.getElementById("LF").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                lineBreaks = !lineBreaks
                if (lineBreaks) {
                    document.getElementById("tables").classList.remove("center-children")
                } else {
                    document.getElementById("tables").classList.add("center-children")
                }
                doIt()
            })


        });

    </script>
</body>

</html>