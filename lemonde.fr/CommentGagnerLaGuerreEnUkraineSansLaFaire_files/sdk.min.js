(()=>{"use strict";var __webpack_modules__=[,(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{let Browser,Platform;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Browser:()=>Browser,Platform:()=>Platform,UserAgent:()=>UserAgent,default:()=>__WEBPACK_DEFAULT_EXPORT__}),function(Browser){Browser[Browser.Unknown=0]="Unknown",Browser[Browser.Generic=1]="Generic",Browser[Browser.Chrome=2]="Chrome",Browser[Browser.Firefox=3]="Firefox",Browser[Browser.Safari=4]="Safari"}(Browser||(Browser={})),function(Platform){Platform[Platform.Unknown=0]="Unknown",Platform[Platform.GenericDesktop=1]="GenericDesktop",Platform[Platform.GenericMobile=2]="GenericMobile",Platform[Platform.IOS=3]="IOS",Platform[Platform.Android=4]="Android",Platform[Platform.MacOS=5]="MacOS",Platform[Platform.Windows=6]="Windows",Platform[Platform.Linux=7]="Linux"}(Platform||(Platform={}));class UserAgent{constructor(userAgentString){let platform=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.navigator.platform;this.rawUA=userAgentString,this.rawPlatform=platform,this.parse()}uaContains(wanted){return-1!==this.rawUA.indexOf(wanted)}platformContains(wanted){return-1!==this.rawPlatform.indexOf(wanted)}isDesktop(){switch(this.platform){case Platform.GenericDesktop:case Platform.MacOS:case Platform.Windows:case Platform.Linux:return!0;default:return!1}}isMobile(){switch(this.platform){case Platform.GenericMobile:case Platform.IOS:case Platform.Android:return!0;default:return!1}}isVAPIDPotentiallySupported(){return(this.isDesktop()||this.platform===Platform.Android)&&(this.browser===Browser.Chrome||this.browser===Browser.Firefox)}parse(){if(this.browser=Browser.Unknown,this.uaContains("Edge/")||this.uaContains("Trident/"))return this.browser=Browser.Generic,void(this.platform=Platform.Windows);if(this.uaContains("iPhone")||this.uaContains("iPad")||this.uaContains("CriOS"))return this.browser=Browser.Generic,void(this.platform=Platform.IOS);if(this.uaContains("Android")?this.platform=Platform.Android:(this.uaContains("Mobi")||this.uaContains("Tablet"))&&(this.platform=Platform.GenericMobile),this.platform!==Platform.Android&&(this.platform=Platform.GenericDesktop),this.platform===Platform.GenericDesktop&&(this.platformContains("Mac")?this.platform=Platform.MacOS:this.platformContains("Win")?this.platform=Platform.Windows:(this.platformContains("Linux")||this.platformContains("X11"))&&(this.platform=Platform.Linux)),this.uaContains("Chrome/")||this.uaContains("Chromium/"))return this.browser=Browser.Chrome,void(this.platform===Platform.Android&&(this.uaContains("; wv")||this.uaContains("(wv;")||this.uaContains("Chrome/30.0.0.0")||this.uaContains("Chrome/33.0.0.0"))&&(this.browser=Browser.Generic));if(this.uaContains("Firefox/"))this.browser=Browser.Firefox;else if(this.uaContains("Version/")&&this.platform===Platform.Android)this.browser=Browser.Generic;else{if(this.uaContains("Safari/"))return this.browser=Browser.Safari,void(this.platform===Platform.GenericDesktop&&(this.platform=Platform.MacOS));this.browser=Browser.Unknown,this.platform===Platform.GenericDesktop&&(this.platform=Platform.Unknown)}}}const __WEBPACK_DEFAULT_EXPORT__=UserAgent},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SDK_API_LVL:()=>SDK_API_LVL,SDK_VERSION:()=>SDK_VERSION,SDK_MAJOR_VERSION:()=>SDK_MAJOR_VERSION,SDK_DISMISS_NOTIF_AFTER:()=>SDK_DISMISS_NOTIF_AFTER,RETRY_MAX_ATTEMPTS:()=>RETRY_MAX_ATTEMPTS,RETRY_MIN_INTERVAL_MS:()=>RETRY_MIN_INTERVAL_MS,SSL_SCRIPT_URL:()=>SSL_SCRIPT_URL,WS_URL:()=>WS_URL,SAFARI_WS_URL:()=>SAFARI_WS_URL,ICONS_URL:()=>ICONS_URL,IS_DEV:()=>IS_DEV,IS_TEST:()=>IS_TEST});const SDK_API_LVL="1",SDK_VERSION="3.0.3",SDK_MAJOR_VERSION="3",SDK_DISMISS_NOTIF_AFTER=30,RETRY_MAX_ATTEMPTS=3,RETRY_MIN_INTERVAL_MS=1e3,SSL_SCRIPT_URL="via.batch.com",WS_URL="https://ws.batch.com/web",SAFARI_WS_URL="https://safari-ws.batch.com",ICONS_URL="https://icons.batch.com",IS_DEV=!1,IS_TEST=!1},,(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LogLevel:()=>LogLevel,Log:()=>Log});var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_helpers_window__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5);let LogLevel;!function(LogLevel){LogLevel[LogLevel.None=0]="None",LogLevel[LogLevel.Public=1]="Public",LogLevel[LogLevel.PublicError=2]="PublicError",LogLevel[LogLevel.Error=3]="Error",LogLevel[LogLevel.Warn=4]="Warn",LogLevel[LogLevel.Info=5]="Info",LogLevel[LogLevel.Trace=6]="Trace",LogLevel[LogLevel.Debug=7]="Debug"}(LogLevel||(LogLevel={}));const Log=new class{constructor(){this.level=LogLevel.PublicError,this.enabledModules=new Set,this.disabledModules=new Set,this.name="SDK",this.enabledModules.add("public"),this.loadStorageSettings(),_config__WEBPACK_IMPORTED_MODULE_0__.IS_DEV&&this.addGlobalEventListeners()}loadStorageSettings(){const safeWindow=(0,_helpers_window__WEBPACK_IMPORTED_MODULE_1__.default)();if(null!=safeWindow&&"object"==typeof safeWindow.localStorage){"1"===safeWindow.localStorage.getItem("com.batch.private.logger.listeners")&&this.addGlobalEventListeners();const rawLevel=safeWindow.localStorage.getItem("com.batch.private.logger.level");if(null!=rawLevel){const level=+rawLevel;level>=0&&level<=7&&(this.level=level)}try{const rawEnabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.enabled");if(rawEnabledModules){const enabledModules=JSON.parse(rawEnabledModules);Array.isArray(enabledModules)&&enabledModules.forEach(m=>{this.enableModule(m)})}const rawDisabledModules=safeWindow.localStorage.getItem("com.batch.private.logger.modules.disabled");if(rawDisabledModules){const disabledModules=JSON.parse(rawDisabledModules);Array.isArray(disabledModules)&&disabledModules.forEach(m=>{this.disableModule(m)})}}catch(_){}}}addGlobalEventListeners(){const safeWindow=(0,_helpers_window__WEBPACK_IMPORTED_MODULE_1__.default)();null!=safeWindow&&(safeWindow.addEventListener("___batchSDK___.logger.enableModule",e=>this.enableModule(e.module)),safeWindow.addEventListener("___batchSDK___.logger.disableModule",e=>this.disableModule(e.module)),safeWindow.addEventListener("___batchSDK___.logger.setLogLevel",e=>{let levelValue;switch(e.level.toLowerCase()){case"none":levelValue=0;break;case"public":levelValue=1;break;case"publicerror":levelValue=2;break;case"error":levelValue=3;break;case"warn":levelValue=4;break;case"info":levelValue=5;break;case"trace":levelValue=6;break;case"debug":default:levelValue=7}this.level=levelValue}))}enableModule(module){this.enabledModules.add(module.toLowerCase())}enableTunneling(to){this.tunnelingTo=to}disableModule(module){this.disabledModules.add(module.toLowerCase())}isModuleEnabled(module){const m=module.toLowerCase();return!this.disabledModules.has(m)&&(this.enabledModules.has("*")||this.enabledModules.has(m))}shouldLogForLevel(wantedLevel){return this.level>0&&wantedLevel<=this.level}logMethodForLevel(wantedLevel){let method;switch(wantedLevel){case LogLevel.Public:method=console.log;break;case LogLevel.PublicError:case LogLevel.Error:method=console.error;break;case LogLevel.Info:method=console.info;break;case LogLevel.Warn:method=console.warn;break;case LogLevel.Trace:method=console.trace;break;case LogLevel.Debug:default:method=console.debug}return method||console.log}getGroupMethod(){return console.group}getGroupEndMethod(){return console.groupEnd}formatPrefix(moduleName){return"public"===moduleName?"Batch":"Batch "+this.name+" ["+moduleName+"]"}public(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];this.log(LogLevel.Public,"public",...args)}publicError(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];this.log(LogLevel.PublicError,"public",...args)}error(module){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)args[_key3-1]=arguments[_key3];this.log(LogLevel.Error,module,...args)}warn(module){for(var _len4=arguments.length,args=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++)args[_key4-1]=arguments[_key4];this.log(LogLevel.Warn,module,...args)}info(module){for(var _len5=arguments.length,args=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++)args[_key5-1]=arguments[_key5];this.log(LogLevel.Info,module,...args)}trace(module){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++)args[_key6-1]=arguments[_key6];this.log(LogLevel.Trace,module,...args)}debug(module){for(var _len7=arguments.length,args=new Array(_len7>1?_len7-1:0),_key7=1;_key7<_len7;_key7++)args[_key7-1]=arguments[_key7];this.log(LogLevel.Debug,module,...args)}log(level,moduleName){for(var _len8=arguments.length,args=new Array(_len8>2?_len8-2:0),_key8=2;_key8<_len8;_key8++)args[_key8-2]=arguments[_key8];if(this.tunnelingTo){const a=[];args.forEach(v=>{switch(typeof v){case"number":case"string":case"boolean":a.push(v);break;case"object":try{a.push(v?"["+v.toString()+"]":null)}catch(e){a.push("[No toString method]")}break;default:a.push("[Unsupported type "+typeof v+"]")}})}level!==LogLevel.Public&&level!==LogLevel.PublicError||(moduleName="public"),this.isModuleEnabled(moduleName)&&this.shouldLogForLevel(level)&&this.logMethodForLevel(level).apply(console,[this.formatPrefix(moduleName)+" -",...args])}grouped(level,module,groupTitle,lines){if(this.isModuleEnabled(module)&&this.shouldLogForLevel(level)){groupTitle?this.getGroupMethod().apply(console,[this.formatPrefix(module)+" -",groupTitle]):this.getGroupMethod().apply(console,[this.formatPrefix(module)]);const logMethod=this.logMethodForLevel(level);lines.forEach(l=>logMethod.apply(console,[l])),this.getGroupEndMethod().apply(console,[])}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function safeGetWindow(){return"object"==typeof window?window:null}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>safeGetWindow})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>newPublicAPI});var com_batch_dom_sdk_impl_sdk_safari__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),com_batch_dom_sdk_impl_sdk_standard__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(35),com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(37),com_batch_dom_ui_uicomponent_handler__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(41),com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(44),com_batch_shared_helpers_primitive__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(20),com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(1),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(21),com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(24),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(4),_config__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(2);function newPublicAPI(){let originalConfig;const ready=new Promise(resolve=>{"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?resolve():(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.debug("public-api","Waiting for DOM to be ready"),window.addEventListener("DOMContentLoaded",()=>{resolve()},!0))}).then(()=>{com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.debug("public-api","DOM is ready")});let instance=null;function getInstance(){return(instance||Promise.reject("Batch is not initialized yet. Have you called 'setup' before calling Batch's API?")).catch(e=>{throw"Batch SDK: Could not initialize Public API: "+e})}const eventBus=com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_7__.LocalEventBus,uiComponents=new com_batch_dom_ui_uicomponent_handler__WEBPACK_IMPORTED_MODULE_3__.UIComponentHandler;let setupCalled=!1;const api={setup:config=>{if(setupCalled)return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.publicError("'setup' cannot be called twice. Ignoring.");setupCalled=!0,originalConfig=(0,com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_4__.default)(config);const uiConfig=(config=(0,com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_4__.default)(config)).ui;uiConfig&&"string"==typeof uiConfig.language&&((0,com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_2__.default)().setLanguage(uiConfig.language),delete uiConfig.language);const origin=document.location.origin.toLowerCase(),sdkConfig=Object.assign({},config,{internal:{origin:origin.startsWith("http")?origin:null,referrer:document.location.href.toLowerCase(),workerScriptUrl:_config__WEBPACK_IMPORTED_MODULE_10__.IS_DEV?"http://localhost:8000/worker.min.js":"https://".concat(_config__WEBPACK_IMPORTED_MODULE_10__.SSL_SCRIPT_URL,"/").concat(_config__WEBPACK_IMPORTED_MODULE_10__.SDK_VERSION,"/worker.min.js")},ui:null});if(window.isSecureContext||com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.warn("public-api","Insecure origin: notification push will not work."),sdkConfig.sameOrigin)throw new Error('Remove "sameOrigin" from the SDK configuration, or downgrade the SDK to the previous major version.');(0,com_batch_shared_helpers_primitive__WEBPACK_IMPORTED_MODULE_5__.asBoolean)(sdkConfig.dev,!1)&&com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.public("Starting version "+_config__WEBPACK_IMPORTED_MODULE_10__.SDK_VERSION+" in development mode.","Environment: Fully secure");const typeSDKFactory=new com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_6__.default(window.navigator.userAgent).browser===com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_6__.Browser.Safari&&new com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_6__.default(window.navigator.userAgent).isDesktop?com_batch_dom_sdk_impl_sdk_safari__WEBPACK_IMPORTED_MODULE_0__.default:com_batch_dom_sdk_impl_sdk_standard__WEBPACK_IMPORTED_MODULE_1__.default;if(instance=ready.then(()=>typeSDKFactory.setup(sdkConfig)),window&&sdkConfig.enableHashFeatures){window.addEventListener("hashchange",e=>{if(e.newURL){const url=new URL(e.newURL);""!==url.hash&&com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_7__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_8__.default.HashChanged,{hash:url.hash},!0)}});const currentHash=window.location.hash;""!==currentHash&&com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_7__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_8__.default.HashChanged,{hash:currentHash},!0),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.debug("Core","Hash features have been enabled by configuration, listening to 'hashchange'.")}instance.then(async sdk=>{await sdk.start();const uiReady=uiComponents.init(uiConfig||{});sdk.getInstallationID().then(iid=>{sdkConfig.dev&&com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.public("Installation ID: "+(iid||"unknown"))});const subPromise=sdk.getSubscriptionState();uiReady.catch(e=>com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.warn("public-api","Error while initializing the ui :",e)).then(()=>subPromise).then(state=>com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_7__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_8__.default.UiReady,state,!1))}).catch(e=>com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_9__.Log.error("public-api","Error while initiliazing batch SDK :",e))},getConfiguration:()=>(0,com_batch_shared_helpers_object_deep_clone__WEBPACK_IMPORTED_MODULE_4__.default)(originalConfig),setCustomUserID:identifier=>getInstance().then(sdk=>sdk.setCustomUserID(identifier)),getCustomUserID:()=>getInstance().then(sdk=>sdk.getCustomUserID()),setUserLanguage:language=>getInstance().then(sdk=>sdk.setLanguage(language)),getUserLanguage:()=>getInstance().then(sdk=>sdk.getLanguage()),setUserRegion:region=>getInstance().then(sdk=>sdk.setRegion(region)),getUserRegion:()=>getInstance().then(sdk=>sdk.getRegion()),getInstallationID:()=>getInstance().then(sdk=>sdk.getInstallationID()),isSubscribed:()=>getInstance().then(sdk=>sdk.isSubscribed()),getNotificationPermission:()=>getInstance().then(sdk=>sdk.getPermission()),subscribe:()=>getInstance().then(sdk=>sdk.subscribe()),unsubscribe:()=>getInstance().then(sdk=>sdk.unsubscribe()),tryToSubscribeFrom:state=>{if(null==state)return Promise.reject("No state given");let p=Promise.resolve(!1);return p=state.subscribed?api.isSubscribed():api.subscribe(),p},getSubscription:()=>getInstance().then(sdk=>sdk.getSubscription()),getSubscriptionState:()=>getInstance().then(sdk=>sdk.getSubscriptionState()),on:(eventCode,callback)=>{eventBus.subscribe(eventCode,(detail,evt)=>callback(api,detail,evt))},ui:{register:(code,init)=>{uiComponents.add(code,(function(config){const compConfigWithTrans=(0,com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_2__.default)().populateDefaultComponentText(config,code);return compConfigWithTrans.popin=(0,com_batch_dom_ui_translator__WEBPACK_IMPORTED_MODULE_2__.default)().populateDefaultComponentText(compConfigWithTrans.popin||{},"popin"),init(api,compConfigWithTrans,component=>{com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_7__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_8__.default.UiComponentDrawn,{code:code,component:component},!1)})}))},registerAfter:(dependencies,code,init)=>{const waitingFor=new Set(dependencies);0===waitingFor.size?api.ui.register(code,init):eventBus.subscribe(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_8__.default.UiComponentReady,cready=>{waitingFor.delete(cready.code)&&0===waitingFor.size&&api.ui.register(code,init)})},get:code=>{const c=uiComponents.getComponent(code);return null!=c?c.component:null},has:code=>uiComponents.getComponentState(code)===com_batch_dom_ui_uicomponent_handler__WEBPACK_IMPORTED_MODULE_3__.UIComponentState.LOADED,waitUntilDrawn:componentCode=>uiComponents.waitUntilDrawn(componentCode),show:(componentCode,force)=>(force=force||!1,api.ui.waitUntilDrawn(componentCode).then(c=>{"function"==typeof c.show&&c.show(force)})),hide:componentCode=>api.ui.waitUntilDrawn(componentCode).then(c=>{"function"==typeof c.hide&&c.hide()}),showPublicIdentifiers:()=>uiComponents.showPublicIdentifiers()}};return api}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_sdk__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8),_sdk_base__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9),com_batch_shared_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class SafariSDK extends _sdk_base__WEBPACK_IMPORTED_MODULE_3__.default{constructor(){super(...arguments),_defineProperty(this,"syncSubscription",async remotePermission=>{if(remotePermission.permission===_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Denied){if(await this.isSubscribed())return this.unsubscribe()}if(remotePermission.permission===_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Granted){const subscription=await this.getSubscription();if(!subscription||subscription!==remotePermission.deviceToken){const newSubscription=remotePermission.deviceToken;return newSubscription&&this.updateSubscription(newSubscription,!0),this.isSubscribed()}}return Promise.resolve(!1)}),_defineProperty(this,"getAllowedDomain",safari=>{const origin=window.location.origin.toString().toLowerCase(),allowedDomain=Object.keys(safari).find(allowedDomain=>origin===allowedDomain);if(!allowedDomain)throw new Error("Current website ".concat(origin," is not present in the 'safari' configuration object"));return allowedDomain}),_defineProperty(this,"fetchDiagnostics",async()=>{const response=await fetch("".concat(com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.SAFARI_WS_URL,"/").concat(this.config.apiKey,"/1.0/diagnostics/").concat(this.websitePushID),{method:"POST",body:JSON.stringify({installId:this.installID})});return await response.json()}),_defineProperty(this,"printDiagnostics",async()=>{try{var _ref;const response=await Promise.race([this.fetchDiagnostics(),(0,com_batch_shared_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_4__.Timeout)(1e4)]);if(!response)throw new Error("Invalid diagnostics server response");if("FAIL"===response.status)return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.publicError(null!==(_ref="[Diagnostics] "+(null==response?void 0:response.error))&&void 0!==_ref?_ref:"Unknown server error");if("OK"===response.status)return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.info("sdk-safari","User has denied permission")}catch(err){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.publicError("[Diagnostics] Cannot diagnose registration issue: Internal server error"),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.error("sdk-safari","Source error: "+err)}}),_defineProperty(this,"requestSafariPermission",async()=>new Promise(resolve=>{"safari"in window&&"pushNotification"in window.safari&&this.websitePushID?(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.debug("sdk-safari","Requesting safari permission"),window.safari.pushNotification.requestPermission("".concat(com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.SAFARI_WS_URL,"/").concat(this.config.apiKey),this.websitePushID,{installID:this.installID},permission=>{com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.debug("sdk-safari","Got safari permission callback: ",JSON.stringify(permission)),resolve(this.getSubscriptionTokenAndPrintStatus(permission))})):resolve(null)})),_defineProperty(this,"getSubscriptionTokenAndPrintStatus",cachedPermission=>{if("safari"in window&&"pushNotification"in window.safari&&this.websitePushID){const{permission:permission,deviceToken:deviceToken}=cachedPermission||window.safari.pushNotification.permission(this.websitePushID);if(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.debug("sdk-safari","getSubscriptionTokenAndPrintStatus: permission",permission,"deviceToken",deviceToken,"NotifPermission",window.Notification.permission),permission===_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Default)return null;if(permission===_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Denied&&window.Notification.permission===_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Denied)return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.info("sdk-safari","User denied permission"),null;if(permission==_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Denied&&window.Notification.permission!==_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Denied)return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.info("sdk-safari","Unknown state: requesting diagnostics"),this.printDiagnostics(),null;if(permission===_sdk__WEBPACK_IMPORTED_MODULE_2__.Permission.Granted)return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.info("sdk-safari","User granted permission"),null!=deviceToken?deviceToken:null}return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.public("sdk-safari","Safari push notifications are not supported in this environment"),null})}async setup(sdkConfig){if(await super.setup(sdkConfig),null==window)throw new Error("Not in a browser page. is it a service worker?");try{if(void 0===sdkConfig.safari)throw new Error("Missing safari configuration");const configWebsitePushID=sdkConfig.safari[this.getAllowedDomain(sdkConfig.safari)];if(!("string"==typeof configWebsitePushID&&configWebsitePushID.length>=0))throw new Error("No valid website push ID for current host in safari configuration");this.websitePushID=configWebsitePushID;try{this.installID=await this.getInstallationID()}catch(e){throw new Error("Could not get installID")}}catch(e){throw await this.startSessionIfNeeded(),e}return this}async start(){if(await super.start(),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.debug("sdk-safari","Tyring to resubscribe for "+this.websitePushID),this.websitePushID){const remotePermission=window.safari.pushNotification.permission(this.websitePushID);try{await this.syncSubscription(remotePermission)}catch(_unused){throw new Error("Could not synchronize subscription status with remote")}}}getTokenForEventParameter(){return this.lastSubscription?{protocol:"APNS",subscription:{deviceToken:this.lastSubscription,websitePushId:this.websitePushID}}:null}async subscribe(){if(!this.getSubscriptionTokenAndPrintStatus()||!this.lastSubscribed){const currentSubscription=await this.requestSafariPermission();await this.updateSubscription(currentSubscription,null!==currentSubscription);const subscribed=await this.isSubscribed();return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.debug("sdk-safari","Reading subscribed:",subscribed),subscribed}return Promise.resolve(!1)}async unsubscribe(){return super.unsubscribe()}readPermission(){return null!=window&&this.websitePushID?Promise.resolve(window.safari.pushNotification.permission(this.websitePushID).permission):Promise.reject("Internal error (no window or websitePushID available, is the SDK setup finished?)")}}const __WEBPACK_DEFAULT_EXPORT__=new class{constructor(){this.instance=null}setup(config){if(null==this.instance){const sdkConfig=Object.assign({},config);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.info("sdk-safari","Instantiating a new SDK");const sdk=new SafariSDK;this.instance=sdk.setup(sdkConfig).then(()=>sdk)}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_1__.Log.warn("sdk-safari","Config cannot be set again once the SDK has already been started");return this.instance||Promise.reject("Setup failed")}getInstance(){return this.instance||Promise.reject("You must setup the SDK before using it")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{let Permission;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Permission:()=>Permission}),function(Permission){Permission.Default="default",Permission.Granted="granted",Permission.Denied="denied"}(Permission||(Permission={}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>BaseSDK});var com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10),com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12),com_batch_shared_event_event_tracker__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(13),com_batch_shared_helpers_primitive__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(20),com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1),com_batch_shared_helpers_uuid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(11),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(21),com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(24),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4),com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(25),com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(27),com_batch_shared_webservice_executor__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(34),_sdk__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(8);class BaseSDK{constructor(){var obj,key,value;value=(current,last)=>current!==last&&(null==current||null==last||current===typeof Object&&last===typeof Object&&(null==current?void 0:current.endpoint)!=(null==last?void 0:last.endpoint)),(key="hasSubscriptionChanged")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}async setup(sdkConfig){try{if(this.config=Object.assign({},sdkConfig),!this.config.apiKey)throw new Error("Configuration error: 'apiKey' is mandatory");if(!this.config.authKey)throw new Error("Configuration error: 'authKey' is mandatory");this.config.dev=(0,com_batch_shared_helpers_primitive__WEBPACK_IMPORTED_MODULE_3__.asBoolean)(this.config.dev,!1);const parameterStore=await com_batch_shared_parameters_parameter_store__WEBPACK_IMPORTED_MODULE_10__.default.getInstance();this.parameterStore=parameterStore,parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.LastConfiguration,this.config);try{null==await parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.InstallationID)&&this.createInstallationID()}catch(e){this.createInstallationID()}let referrer;if(this.config.internal&&this.config.internal.referrer&&(referrer=this.config.internal.referrer),this.webserviceExecutor=new com_batch_shared_webservice_executor__WEBPACK_IMPORTED_MODULE_11__.default(this.config.apiKey,this.config.authKey,this.config.dev,referrer,parameterStore),this.eventTracker=new com_batch_shared_event_event_tracker__WEBPACK_IMPORTED_MODULE_2__.default(this.config.dev,this.webserviceExecutor),new com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__.UserAgent(window.navigator.userAgent).browser!==com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__.Browser.Safari)try{if(null!==window&&void 0!==window.navigator&&"permissions"in window.navigator){(await window.navigator.permissions.query({name:"notifications"})).addEventListener("change",this.checkUpdate.bind(this))}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.warn("sdk-base","Cannot listen to permission changes: API unavailable")}catch(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.warn("sdk-base","Error while listening to permission changes (not a fatal error)",e)}return null!=window&&(new com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__.UserAgent(window.navigator.userAgent).browser===com_batch_shared_helpers_user_agent__WEBPACK_IMPORTED_MODULE_4__.Browser.Firefox&&window.setInterval(this.checkUpdate.bind(this),5e3),window.addEventListener("focus",this.checkUpdate.bind(this))),this}catch(e){throw com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.error("sdk-base","Error while initializing the sdk",e),new Error("Error while initializing the sdk")}}async start(){const stPromise=this.parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription).then(s=>this.lastSubscription=s),sdPromise=this.parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed).then(s=>this.lastSubscribed=!0===s);await Promise.all([stPromise,sdPromise]),this.lastPermission=await this.readPermission(),this.lastState={permission:this.lastPermission||_sdk__WEBPACK_IMPORTED_MODULE_12__.Permission.Default,subscribed:this.lastSubscribed||!1},await this.startSessionIfNeeded()}async clearSession(){const store=await this.getParameterStore();await store.removeParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.session.SessionID)}async startSessionIfNeeded(){const store=await this.getParameterStore();var _this$eventTracker;return null===await store.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.session.SessionID)&&(await store.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.session.SessionID,(0,com_batch_shared_helpers_uuid__WEBPACK_IMPORTED_MODULE_5__.default)()),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.info("sdk-base","New session : "+com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Start+" sent","with sub",this.lastSubscription),null===(_this$eventTracker=this.eventTracker)||void 0===_this$eventTracker||_this$eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Start,{token:this.getTokenForEventParameter()})),!0)}getParameterStore(){return null!=this.parameterStore?Promise.resolve(this.parameterStore):Promise.reject("parameter store null")}async createInstallationID(){const parameterStore=await this.getParameterStore();return await parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.InstallationID,(0,com_batch_shared_helpers_uuid__WEBPACK_IMPORTED_MODULE_5__.default)())}async bumpProfileVersion(){const parameterStore=await this.getParameterStore(),version=await parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserProfileVersion),intVal=null==version?NaN:parseInt(version,10);return await parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserProfileVersion,isNaN(intVal)?0:intVal+1),!0}async setProfileParameter(key,identifier){const definedIdentifier=void 0===identifier?null:identifier,parameterStore=await this.getParameterStore();return await parameterStore.setOrRemoveParameterValueIfChanged(key,definedIdentifier)&&this.bumpProfileVersion().then(()=>{this.eventTracker&&this.eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.ProfileChanged)),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_6__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_7__.default.ProfileChanged,{[key]:definedIdentifier},!0)}),definedIdentifier}async setCustomUserID(identifier){return await this.setProfileParameter(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.CustomIdentifier,identifier),void 0===identifier?null:identifier}setLanguage(lang){return this.setProfileParameter(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserLanguage,lang)}setRegion(lang){return this.setProfileParameter(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserRegion,lang)}async getCustomUserID(){const p=await this.getParameterStore();return await p.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.CustomIdentifier)}async getLanguage(){const p=await this.getParameterStore();return await p.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserLanguage)}async getRegion(){const p=await this.getParameterStore();return await p.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.UserRegion)}async getInstallationID(){const parameterStore=await this.getParameterStore(),installID=await parameterStore.getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.InstallationID);if(null!=installID)return installID;throw new Error("Invalid internal state")}async isSubscribed(){return!("granted"!==await this.getPermission()||!await this.readAndCheckSubscribed())&&this.getSubscription().then(sub=>null!=sub)}async getPermission(){const perm=await this.readPermission();return await this.updatePermission(perm)}readPermission(){return null!=window?Promise.resolve(window.Notification.permission):Promise.reject("Internal error (no window available)")}async subscribe(){if("granted"===await this.getPermission())return this.updateSubscribed(!0),this.isSubscribed();throw new Error("Permission denied")}async unsubscribe(){return await this.updateSubscribed(!1),!await this.isSubscribed()}getSubscription(){return this.readAndCheckSubscription()}async getSubscriptionState(){return{permission:await this.getPermission(),subscribed:await this.isSubscribed()}}async checkUpdate(){await this.getSubscriptionState()}async readAndCheckSubscribed(){let sub=await(await this.getParameterStore()).getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed);sub=!0===sub;const last=this.lastSubscribed;return last!==sub&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.info("sdk-base","Subscribed updated from "+last+" to "+sub),this.lastSubscribed=sub,this.subscriptionChanged(!0)),sub}async readAndCheckSubscription(){const currentSubscription=await(await this.getParameterStore()).getParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription),lastSubscription=this.lastSubscription;return this.hasSubscriptionChanged(currentSubscription,lastSubscription)&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.info("sdk-base","Subscription updated",currentSubscription),this.lastSubscription=currentSubscription,this.subscriptionChanged(!0)),currentSubscription}async updateSubscribed(subscribed){return(await this.getParameterStore()).setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed,subscribed),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.debug("sdk-base","Writring subscribed:",subscribed),this.readAndCheckSubscribed()}async updateSubscription(sub,subscribed){const parameterStore=await this.getParameterStore();return void 0===sub||null==sub?await parameterStore.removeParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription):await parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscription,sub),"boolean"==typeof subscribed&&(parameterStore.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed,subscribed),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_8__.Log.debug("sdk-base","Writring subscribed:",subscribed)),this.readAndCheckSubscription()}async updatePermission(perm){return this.lastPermission!==perm&&(this.lastPermission=perm,this.subscriptionChanged(!1)),perm}async subscriptionChanged(){let tokenChanged=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const state=await this.getSubscriptionState();if((tokenChanged||!this.lastState||this.lastState.subscribed!==state.subscribed)&&this.eventTracker){const params={token:this.getTokenForEventParameter()};this.config.internal&&this.config.internal.referrer&&(params.referrer=this.config.internal.referrer),this.eventTracker.track(new com_batch_shared_event_event__WEBPACK_IMPORTED_MODULE_0__.default(state.subscribed?com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Subscribed:com_batch_shared_event_event_names__WEBPACK_IMPORTED_MODULE_1__.InternalSDKEvent.Unsubscribed,params));const p=await this.getParameterStore();await p.setParameterValue(com_batch_shared_parameters_keys__WEBPACK_IMPORTED_MODULE_9__.keysByProvider.profile.Subscribed,state.subscribed)}this.lastState=state,com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_6__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_7__.default.SubscriptionChanged,state,!0)}getTokenForEventParameter(){return this.lastSubscription?{protocol:"WPP",subscription:this.lastSubscription}:null}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Event});var _helpers_uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11);class Event{constructor(name,params){if("string"!=typeof name)throw new Error("Error while constructing Event: 'name' is required and should be a string");if(this.id=(0,_helpers_uuid__WEBPACK_IMPORTED_MODULE_0__.default)(),this.name=name.toUpperCase(),this.date=new Date,null!=params&&"object"!=typeof params)throw new Error("Error while constructing Event: 'params' is optional but must be an object if provided");this.params=params||{}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>uuid});const supportsPRNG=void 0!==self.crypto&&void 0!==self.crypto.getRandomValues;function uuid(){const randomNumbers=new Array(31);if(supportsPRNG){const prngRandomBytes=new Uint8Array(randomNumbers.length);self.crypto.getRandomValues(prngRandomBytes);for(let i=0;i<randomNumbers.length;i+=1)randomNumbers[i]=prngRandomBytes[i]%16|0}else for(let i=0;i<randomNumbers.length;i+=1)randomNumbers[i]=16*Math.random()|0;randomNumbers[15]=3&randomNumbers[15]|8;let uuidString="";for(let i=0;i<randomNumbers.length;i+=1)uuidString+=randomNumbers[i].toString(16),7===i||14===i||18===i?uuidString+="-":11===i&&(uuidString+="-4");return uuidString}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{let InternalSDKEvent;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{InternalSDKEvent:()=>InternalSDKEvent}),function(InternalSDKEvent){InternalSDKEvent.ProfileChanged="_PROFILE_CHANGED",InternalSDKEvent.Start="_START",InternalSDKEvent.Subscribed="_SUBSCRIPTION",InternalSDKEvent.Unsubscribed="_UNSUBSCRIPTION",InternalSDKEvent.PushOpen="_OPEN_PUSH"}(InternalSDKEvent||(InternalSDKEvent={}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EventTracker});var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14),_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_webservice_event_tracker__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15),_webservice_http_error__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19);class EventTracker{constructor(dev,webserviceExecutor){var obj,key,value;value=200,(key="debounceDelay")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.dev=dev,this.buffer=[],this.webserviceExecutor=webserviceExecutor,this.attemptRunning=!1,this.lastForbiddenLog=0}track(event){_logger__WEBPACK_IMPORTED_MODULE_2__.Log.debug("Event Tracker","Tracking event '".concat(event.name,"'")),this.buffer.push(event),this.debounceSend&&clearTimeout(this.debounceSend),this.debounceSend=self.setTimeout(()=>{this.send()},this.debounceDelay)}send(){let retryCount=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===retryCount&&this.attemptRunning||0===this.buffer.length)return!1;const eventsToSend=this.buffer;return this.buffer=[],this.attemptRunning=!0,this.webserviceExecutor.start(new _webservice_event_tracker__WEBPACK_IMPORTED_MODULE_3__.default(eventsToSend)).then(()=>{this.attemptRunning=!1,this.send()}).catch(e=>{this.buffer.push(...eventsToSend),retryCount+=1,retryCount<_config__WEBPACK_IMPORTED_MODULE_0__.RETRY_MAX_ATTEMPTS?(0,_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__.Delay)(_config__WEBPACK_IMPORTED_MODULE_0__.RETRY_MIN_INTERVAL_MS).then(()=>{this.send(retryCount)}):(this.attemptRunning=!1,e instanceof _webservice_http_error__WEBPACK_IMPORTED_MODULE_4__.default&&(401===e.response.status||403===e.response.status)&&Date.now()-this.lastForbiddenLog>1e4&&this.logForbiddenError())}),!0}logForbiddenError(){this.lastForbiddenLog=Date.now(),_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Error: Could not authenticate against Batch's servers");let log="Is your configuration 'apiKey'/'authKey' pair correct?";this.dev&&(log+=" In development mode, you also need to add the current origin to 'allowed dev origins' in the dashboard under 'Push Settings'"),_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError(log)}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function Delay(duration){return new Promise(resolve=>setTimeout(resolve,duration))}function Timeout(duration){return Delay(duration).then(()=>Promise.reject("Timeout after "+duration+"ms"))}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Delay:()=>Delay,Timeout:()=>Timeout})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>EventTrackerWebservice});var _base__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(16);class EventTrackerWebservice extends _base__WEBPACK_IMPORTED_MODULE_0__.default{constructor(events){super(),this.events=events}getQuery(){return{payload:this.events.map(e=>Object.assign({},e,{date:e.date.toISOString()}))}}getURLShortname(){return"ev"}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>BaseWebservice});var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17),_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(18);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const DefaultHeaderKeys=[_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.CustomIdentifier,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserRegion,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserLanguage,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.UserProfileVersion,_parameters_keys_profile__WEBPACK_IMPORTED_MODULE_1__.ProfileKeys.InstallationID,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.SDKAPILevel,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezone,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezoneOffset,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceDate,_parameters_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceLanguage],BaseURL="".concat(_config__WEBPACK_IMPORTED_MODULE_0__.WS_URL,"/").concat(_config__WEBPACK_IMPORTED_MODULE_0__.SDK_VERSION,"/");class BaseWebservice{getHeaders(parameterStore){return parameterStore.getParametersValues(DefaultHeaderKeys).then(parameters=>(Object.keys(parameters).forEach(key=>{const value=parameters[key];null!=value&&(parameters[key]=""+value)}),parameters))}getBody(parameterStore){return this.getHeaders(parameterStore).then(h=>_objectSpread(_objectSpread({},this.getQuery()),{},{ids:h}))}getBaseURL(){return BaseURL+this.getURLShortname()}getQuery(){throw new Error("BaseWebservice subclasses should override getQuery()")}getURLShortname(){throw new Error("BaseWebservice subclasses should override getURLShortname()")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{let ProfileKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ProfileKeys:()=>ProfileKeys}),function(ProfileKeys){ProfileKeys.InstallationID="di",ProfileKeys.CustomIdentifier="cus",ProfileKeys.UserRegion="ure",ProfileKeys.UserLanguage="ula",ProfileKeys.UserProfileVersion="upv",ProfileKeys.Subscription="subscription",ProfileKeys.Subscribed="subscribed",ProfileKeys.LastConfiguration="lastconfig"}(ProfileKeys||(ProfileKeys={}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{let SystemKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SystemKeys:()=>SystemKeys}),function(SystemKeys){SystemKeys.SDKAPILevel="lvl",SystemKeys.DeviceTimezone="dtz",SystemKeys.DeviceTimezoneOffset="dtzo",SystemKeys.DeviceDate="da",SystemKeys.DeviceLanguage="dla"}(SystemKeys||(SystemKeys={}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>HttpError});class HttpError extends Error{constructor(response,message){super(message||'Response not ok. Status text: "'.concat(response.statusText,'"')),this.response=response}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function asBoolean(value,fallback){return"boolean"==typeof value?value:"number"==typeof value?0!==value:fallback}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{asBoolean:()=>asBoolean})},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Evt:()=>Evt,EventBus:()=>EventBus,LocalEventBus:()=>LocalEventBus});var _helpers_bounded_queue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(22),_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23),_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(24),_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4);class Evt{constructor(code,detail,consumed){this.code=code,this.detail=detail,this.consumed=consumed}}class EventBus{constructor(){this.listeners=new Map,this.passedEvents=new Map}subscribe(evt,listener){if("function"!=typeof listener||"string"!=typeof evt)throw new Error("wrong parameters");this.getListenersFor(evt).push(listener),_logger__WEBPACK_IMPORTED_MODULE_3__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_3__.LogLevel.Info,"local-bus","new listener subscribed",["to: "+evt,listener]),this.emitMissedEvents(evt,listener)}emit(code,detail,consumePrevious){if(code===_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__.default.All)return void _logger__WEBPACK_IMPORTED_MODULE_3__.Log.warn("local-bus","The event * can't be triggered");const evt=new Evt(code,detail||{},consumePrevious),passed=this.getPassedEventsFor(code),last=passed.peek();consumePrevious&&(passed.clear(),passed.push(evt)),(0,_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_1__.default)(last,evt)?_logger__WEBPACK_IMPORTED_MODULE_3__.Log.debug("local-bus","skipped",evt):(consumePrevious||passed.push(evt),_logger__WEBPACK_IMPORTED_MODULE_3__.Log.debug("local-bus","emit",evt),(this.listeners.get(code)||[]).forEach(e=>e(evt.detail,evt)),(this.listeners.get(_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__.default.All)||[]).forEach(e=>e(evt.detail,evt)))}getListenersFor(evt){let listeners=this.listeners.get(evt);return listeners||(listeners=[],this.listeners.set(evt,listeners)),listeners}emitMissedEvents(code,listener){code===_local_sdk_events__WEBPACK_IMPORTED_MODULE_2__.default.All?this.passedEvents.forEach((_value,key)=>this.emitMissedEvents(key,listener)):this.passedEvents.has(code)&&this.getPassedEventsFor(code).forEach(evt=>listener(evt.detail,evt))}getPassedEventsFor(code){let events=this.passedEvents.get(code);return null==events&&(events=new _helpers_bounded_queue__WEBPACK_IMPORTED_MODULE_0__.default(10),this.passedEvents.set(code,events)),events}}const LocalEventBus=new EventBus},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>BoundedQueue});class BoundedQueue{constructor(capacity){if(this.backingArray=[],this.capacity=capacity,capacity<=0)throw new Error("Capacity must be greater than zero")}enforceCapacity(){for(;this.backingArray.length>this.capacity;)this.backingArray.shift()}push(value){this.backingArray.push(value),this.enforceCapacity()}peek(){return 0===this.backingArray.length?null:this.backingArray[this.backingArray.length-1]}pop(){return 0===this.backingArray.length?null:this.backingArray.pop()}clear(){this.backingArray.length=0}forEach(method,_thisArg){this.backingArray.forEach(method)}values(){return this.backingArray}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});const isNull=value=>null==value,isBuffer=value=>!(!value||"object"!=typeof value||"number"!=typeof value.length)&&("function"==typeof value.copy&&"function"==typeof value.slice&&!(value.length>0&&"number"!=typeof value[0])),deepEqual=(actual,expected)=>{if(actual===expected)return!0;if(actual instanceof Date&&expected instanceof Date)return actual.getTime()===expected.getTime();if(!actual||!expected||"object"!=typeof actual&&"object"!=typeof expected)return actual===expected;if(isNull(actual)||isNull(expected))return!1;if(actual.prototype!==expected.prototype)return!1;if(isBuffer(actual)){if(!isBuffer(expected)||actual.length!==expected.length)return!1;for(let i=0;i<actual.length;i++)if(actual[i]!==expected[i])return!1;return!0}if(typeof actual!=typeof expected)return!1;let ka,kb;try{ka=Object.keys(actual),kb=Object.keys(expected)}catch(e){return!1}if(ka.length!==kb.length)return!1;for(let i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return!1;for(let i=ka.length-1;i>=0;i--){const key=ka[i];if(!deepEqual(actual[key],expected[key]))return!1}return!0},__WEBPACK_DEFAULT_EXPORT__=deepEqual},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var LocalSDKEvent;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__}),function(LocalSDKEvent){LocalSDKEvent.All="*",LocalSDKEvent.ProfileChanged="profileChanged",LocalSDKEvent.SubscriptionChanged="subscriptionChanged",LocalSDKEvent.UiComponentReady="uiComponentReady",LocalSDKEvent.UiComponentDrawn="uiComponentDrawn",LocalSDKEvent.UiReady="uiReady",LocalSDKEvent.HashChanged="hashChanged"}(LocalSDKEvent||(LocalSDKEvent={}));const __WEBPACK_DEFAULT_EXPORT__=LocalSDKEvent},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{allowedKeyByProvider:()=>allowedKeyByProvider,keysByProvider:()=>keysByProvider});var _keys_profile__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17),_keys_session__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(18);function getValuesArrayForStringEnum(e){return Object.keys(e).map(key=>e[key])}const allowedKeyByProvider={profile:getValuesArrayForStringEnum(_keys_profile__WEBPACK_IMPORTED_MODULE_0__.ProfileKeys),session:getValuesArrayForStringEnum(_keys_session__WEBPACK_IMPORTED_MODULE_1__.SessionKeys),system:getValuesArrayForStringEnum(_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys)},keysByProvider={profile:_keys_profile__WEBPACK_IMPORTED_MODULE_0__.ProfileKeys,session:_keys_session__WEBPACK_IMPORTED_MODULE_1__.SessionKeys,system:_keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{let SessionKeys;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SessionKeys:()=>SessionKeys}),function(SessionKeys){SessionKeys.SessionID="sessionId"}(SessionKeys||(SessionKeys={}))},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ParameterStore});var _helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(23),_persistence_indexed_db__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28),_persistence_session__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(29),_keys__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(25),_profile_parameter_provider__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(30),_session_parameter_provider__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(32),_system_parameter_provider__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(33);let storeInstance=null;class ParameterStore{constructor(p){this.providers=p}getParameterValue(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.system.indexOf(key)?this.providers.system.getParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.getParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?this.providers.session.getParameterForKey(key):Promise.reject("Cannot read ".concat(key,": it is not a managed key"))}async setParameterValue(key,value){return void 0===value||null==value?Promise.reject("Refusing to write null/unknown for ".concat(key,". Use removeParameterValue to do so explicitly.")):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.setParameterForKey(key,value):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?(await this.providers.session.setParameterForKey(key,String(value)),value):Promise.reject("Cannot set ".concat(key,": it is not a managed key"))}removeParameterValue(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.profile.indexOf(key)?this.providers.profile.removeParameterForKey(key):-1!==_keys__WEBPACK_IMPORTED_MODULE_3__.allowedKeyByProvider.session.indexOf(key)?this.providers.session.removeParameterForKey(key):Promise.reject("Cannot delete ".concat(key,": it is not a managed key"))}setOrRemoveParameterValueIfChanged(key,value){const definedValue=void 0===value?null:value;return new Promise((resolve,reject)=>{this.getParameterValue(key).then(oldValue=>{(0,_helpers_deep_obj_compare__WEBPACK_IMPORTED_MODULE_0__.default)(oldValue,value)?resolve(!1):null==definedValue?this.removeParameterValue(key).then(()=>resolve(!0)).catch(reject):this.setParameterValue(key,value).then(()=>resolve(!0)).catch(reject)},error=>{reject(error)})})}async getParametersValues(keys){const promises=keys.map(key=>this.getParameterValue(key));return(await Promise.all(promises)).reduce((acc,cur,indice)=>(acc[keys[indice]]=cur,acc),{})}static getInstance(){return new Promise(resolve=>{storeInstance instanceof ParameterStore?resolve(storeInstance):_persistence_indexed_db__WEBPACK_IMPORTED_MODULE_1__.default.getInstance().then(IndexedDb=>{storeInstance=new ParameterStore({profile:new _profile_parameter_provider__WEBPACK_IMPORTED_MODULE_4__.default(IndexedDb),session:new _session_parameter_provider__WEBPACK_IMPORTED_MODULE_5__.default(new _persistence_session__WEBPACK_IMPORTED_MODULE_2__.default),system:new _system_parameter_provider__WEBPACK_IMPORTED_MODULE_6__.default}),resolve(storeInstance)})})}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});const tableName="BatchKVData";class IndexedDbPersistence{openDatabase(){return new Promise((resolve,reject)=>{indexedDB||reject(new Error("IndexedDB is not available"));const request=indexedDB.open("BatchWebPush",1);request.onerror=err=>{reject(err)},request.onsuccess=event=>{const db=event.target.result;db.onversionchange=()=>{db.close()},this.selfHeal(db),resolve(db)},request.onupgradeneeded=event=>{const db=event.target.result;this.createObjectStore(db)},request.onblocked=()=>{reject(new Error("IndexedDB is blocked by another tab"))}})}createObjectStore(db){db.createObjectStore(tableName,{keyPath:"k"})}selfHeal(db){db.objectStoreNames.contains(tableName)||this.createObjectStore(db)}async getData(key){const db=await this.openDatabase();return new Promise((resolve,reject)=>{const query=db.transaction([tableName]).objectStore(tableName).get(key);query.onerror=reject,query.onsuccess=()=>{const data=query.result;resolve(void 0===data?null:data.value)}}).finally(()=>db.close())}async setData(key,value){const db=await this.openDatabase();return new Promise((resolve,reject)=>{const query=db.transaction([tableName],"readwrite").objectStore(tableName).put({k:key,value:value});query.onerror=reject,query.onsuccess=()=>resolve(value)}).finally(()=>db.close())}async removeData(key){const db=await this.openDatabase();return new Promise((resolve,reject)=>{const query=db.transaction([tableName],"readwrite").objectStore(tableName).delete(key);query.onerror=reject,query.onsuccess=()=>resolve()}).finally(()=>db.close())}static getInstance(){return new Promise(resolve=>{resolve(new IndexedDbPersistence)})}}const __WEBPACK_DEFAULT_EXPORT__=IndexedDbPersistence},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});const safeWindow=(0,__webpack_require__(5).default)();const __WEBPACK_DEFAULT_EXPORT__=class{getData(key){return null==safeWindow?Promise.reject("No session storage available"):new Promise(resolve=>resolve(safeWindow.sessionStorage.getItem(key)))}setData(key,value){return null==safeWindow?Promise.reject("No session storage available"):new Promise(resolve=>{safeWindow.sessionStorage.setItem(key,value),resolve(value)})}removeData(key){return null==safeWindow?Promise.reject("No session storage available"):new Promise(resolve=>{safeWindow.sessionStorage.removeItem(key),resolve()})}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31),_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);const __WEBPACK_DEFAULT_EXPORT__=class{constructor(storageProvider){this.storage=storageProvider}async getParameterForKey(key){if(-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)){const value=await this.storage.getData(key);return void 0===value?null:value}throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Cannot read ".concat(key,": it is not a managed profile key"))}setParameterForKey(key,value){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)?this.storage.setData(key,value):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Cannot set ".concat(key,": it is not a managed profile key")))}removeParameterForKey(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.profile.indexOf(key)?this.storage.removeData(key):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("".concat(key," is not a managed profile key")))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>BatchError});class BatchError extends Error{}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _batch_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31),_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);const __WEBPACK_DEFAULT_EXPORT__=class{constructor(storageProvider){this.storage=storageProvider}async getParameterForKey(key){if(-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)){const value=await this.storage.getData("com.batch."+key);return void 0===value?null:value}throw new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Cannot read ".concat(key,": it is not a managed session key"))}setParameterForKey(key,value){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)?this.storage.setData("com.batch."+key,value):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Cannot set ".concat(key,": it is not a managed session key")))}removeParameterForKey(key){return-1!==_keys__WEBPACK_IMPORTED_MODULE_1__.allowedKeyByProvider.session.indexOf(key)?(this.storage.removeData("com.batch."+key),Promise.resolve()):Promise.reject(new _batch_error__WEBPACK_IMPORTED_MODULE_0__.default("Cannot delete ".concat(key,": it is not a managed session key")))}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_batch_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31),_keys_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(18);class SystemParameterProvider{getParameterForKey(key){return new Promise(resolve=>{switch(key){case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.SDKAPILevel:resolve(_config__WEBPACK_IMPORTED_MODULE_0__.SDK_API_LVL);break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezone:resolve(SystemParameterProvider.getTimezone()||"");break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceTimezoneOffset:resolve((new Date).getTimezoneOffset().toString());break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceLanguage:{const navigator=self.navigator;resolve(null!=navigator?navigator.language:"")}break;case _keys_system__WEBPACK_IMPORTED_MODULE_2__.SystemKeys.DeviceDate:resolve((new Date).toISOString());break;default:throw new _batch_error__WEBPACK_IMPORTED_MODULE_1__.default("".concat(key," is not a managed system key"))}})}static getTimezone(){if(self.Intl){const autoTZ=self.Intl.DateTimeFormat().resolvedOptions().timeZone;if(autoTZ)return autoTZ}return null}}const __WEBPACK_DEFAULT_EXPORT__=SystemParameterProvider},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>WebserviceExecutor});var _logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),_http_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(19);class WebserviceExecutor{constructor(apiKey,authKey,devMode,referrer,parameterStore){this.apiKey=apiKey,this.authKey=authKey,this.devMode=devMode,this.referrer=referrer,this.parameterStore=parameterStore}async start(ws){if("undefined"==typeof fetch)return Promise.reject(new Error("fetch API isn't available"));const options={body:"",cache:"no-cache",credentials:"omit",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),method:"POST",mode:"cors"};this.devMode||"string"!=typeof this.authKey||options.headers.set("X-Batch-Auth",this.authKey),this.devMode&&options.headers.set("X-Batch-Dev","true"),this.referrer&&options.headers.set("X-Batch-Referer",this.referrer);try{const body=await ws.getBody(this.parameterStore);options.body=JSON.stringify(body);const URL=ws.getBaseURL()+"/"+this.apiKey;_logger__WEBPACK_IMPORTED_MODULE_0__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Info,"WSExecutor","Calling WS",["URL: ".concat(URL),body,options]);const response=await fetch(URL,options);if(!response.ok)throw new _http_error__WEBPACK_IMPORTED_MODULE_1__.default(response);return _logger__WEBPACK_IMPORTED_MODULE_0__.Log.grouped(_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Info,"WSExecutor","WS finished successfuly",["Status text: ".concat(response.statusText)]),!0}catch(error){throw _logger__WEBPACK_IMPORTED_MODULE_0__.Log.error("WSExecutor","Error while executing WS",error),error}}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var com_batch_shared_helpers_push_helper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(36),com_batch_shared_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_sdk_base__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9);class StandardSDK extends _sdk_base__WEBPACK_IMPORTED_MODULE_3__.default{async setup(sdkConfig){if(await super.setup(sdkConfig),null==window)throw new Error("not in a browser page. is it a service worker?");if(!("serviceWorker"in window.navigator))throw new Error("no service worker");if(!("PushManager"in window))throw new Error("Push messaging isn't supported.");if(!sdkConfig.vapidPublicKey)throw new Error("Invalid public key");try{this.pubKey=(0,com_batch_shared_helpers_push_helper__WEBPACK_IMPORTED_MODULE_0__.urlBase64ToUint8Array)(sdkConfig.vapidPublicKey)}catch(e){throw com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Could not decode 'vapidPublicKey'. Is it well formatted?"),new Error("Could not decode 'vapidPublicKey'. Is it well formatted?")}if(null==window.navigator.serviceWorker)throw new Error("Browser does not support service workers");{const timeout=Math.max(10,sdkConfig.serviceWorkerTimeout||10);let swPath="/batchsdk-worker-loader.js";"string"==typeof sdkConfig.serviceWorkerPathOverride&&(swPath=sdkConfig.serviceWorkerPathOverride||swPath);try{return await Promise.race([this.initServiceWorker(swPath),(0,com_batch_shared_helpers_timed_promise__WEBPACK_IMPORTED_MODULE_1__.Timeout)(1e3*timeout)]),this}catch(e){throw com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.error("sdk-standard","Error while initializing service worker :",e),sdkConfig.useExistingServiceWorker?com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Timed out while waiting for the existing service worker: is your service worker properly registered?\nOriginal error: "+e):com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.publicError("Failed to register the service worker. Is it accessible at '"+swPath+"'?\nOriginal error: "+e),new Error("An error occurred while initializing the service worker: "+e)}}}async initServiceWorker(swPath){const sdkConfig=this.config,swContainer=window.navigator.serviceWorker;sdkConfig.useExistingServiceWorker?com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-standard","Not registering Batch's, we have been asked to use the existing one"):await swContainer.register(swPath,{scope:"/"});const registration=await swContainer.ready;com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-standard","service worker ready");const worker=registration.active;this.worker=worker,this.pushManager=registration.pushManager,worker&&(worker.postMessage("batchSDKConfigLoaded"),worker.addEventListener("message",this.handleWorkerMessage))}handleWorkerMessage(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.debug("sdk-standard","just received a service worker event",e)}getPushManager(){return null!=this.pushManager?Promise.resolve(this.pushManager):Promise.reject("push manager is null")}getWorker(){return null!=this.worker?Promise.resolve(this.worker):Promise.reject("worker is null")}async subscribe(){const pm=await this.getPushManager();let sub;try{sub=await pm.subscribe({applicationServerKey:this.pubKey,userVisibleOnly:!0})}catch(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-standard","subscription failed",e),sub=null}await this.updateSubscription(sub?sub.toJSON():null,null!=sub);return await this.isSubscribed()}async unsubscribe(){const pm=await this.getPushManager();let sub;try{sub=await pm.getSubscription()}catch(e){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-standard","unsubscription failed",e),sub=null}return this.updateSubscription(sub?sub.toJSON():null),super.unsubscribe()}async getSubscription(){var _window,_window$Notification;if("granted"!==(null===(_window=window)||void 0===_window||null===(_window$Notification=_window.Notification)||void 0===_window$Notification?void 0:_window$Notification.permission))return super.getSubscription();try{const pushManager=await this.getPushManager(),sub=await pushManager.getSubscription();return this.updateSubscription(sub?sub.toJSON():null)}catch(e){return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-standard","get subscription failed, reading it from the database. error:",e),super.getSubscription()}}}const __WEBPACK_DEFAULT_EXPORT__=new class{constructor(){this.instance=null}setup(config){if(null==this.instance){const sdkConfig=Object.assign({},config);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.info("sdk-standard","Instantiating a new SDK");const sdk=new StandardSDK;this.instance=sdk.setup(sdkConfig).then(()=>sdk)}else com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_2__.Log.warn("sdk-standard","Config cannot be set again once the SDK has already been started");return this.instance||Promise.reject("Setup failed")}getInstance(){return this.instance||Promise.reject("You must setup the SDK before using it")}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{urlBase64ToUint8Array:()=>urlBase64ToUint8Array});const urlBase64ToUint8Array=base64String=>{const base64=(base64String+"=".repeat((4-base64String.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),rawData=self.atob(base64),outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;i+=1)outputArray[i]=rawData.charCodeAt(i);return outputArray}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38);const comps=["button","switcher","banner","popin","alert","public-identifiers"],getTransForComponent=(languageCode,componentCode)=>{const translationsMap=(languageCode=>Object.prototype.hasOwnProperty.call(com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__.translations,languageCode)?com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__.translations[languageCode]:com_batch_translations_translations__WEBPACK_IMPORTED_MODULE_0__.translations.en)(languageCode);return Object.prototype.hasOwnProperty.call(translationsMap,componentCode)&&translationsMap[componentCode]||{}};class Translator{constructor(languageCode){this.lg=languageCode}setLanguage(languageCode){this.lg=languageCode}populateDefaultComponentText(uiConfig,componentCode){if(-1===comps.indexOf(componentCode))return uiConfig;const defaultTranslations=getTransForComponent(this.lg,componentCode);return uiConfig=Object.assign({},defaultTranslations,uiConfig)}}let instance=null;const __WEBPACK_DEFAULT_EXPORT__=languageCode=>(instance?languageCode&&instance.setLanguage(languageCode):instance=new Translator("string"==typeof languageCode?languageCode:navigator.language),instance)},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{translations:()=>translations});var _en__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39),_fr__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(40);const translations={en:_en__WEBPACK_IMPORTED_MODULE_0__.translations,fr:_fr__WEBPACK_IMPORTED_MODULE_1__.translations}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{translations:()=>translations});const shared_step1="Step 1:",shared_step2="Step 2:",shared_chrome1="Click on the button to the left of the address bar",shared_chrome2="On the Notifications permission, click on Allow",shared_firefox1="Click on the bubble button to the left of the address bar",shared_firefox2='Click on the cross [x] next to "Blocked"',translations={popin:{title:"Allow notifications",btnSub:"Subscribe",btnUnsub:"Unsubscribe",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2,safari1:"Click on Safari > Preferences in the top menu",safari2:"In Notifications, choose Allow for this website"},button:{hover:"Manage notifications "},banner:{text:"Never miss an update !",btnSub:"Subscribe",btnUnsub:"Unsubscribe",title:"Reactivate notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},alert:{text:"Never miss an update !",positiveSubBtnLabel:"Subscribe",positiveUnsubBtnLabel:"Unsubscribe",negativeBtnLabel:"No, thanks",title:"Reactivate notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},"public-identifiers":{titleLabel:"Batch SDK - Identifiers",isRegisteredLabel:"Subscribed to notifications?",closeLabel:"Close",loadingText:"Loading...",noValueText:"<No value>",errorText:"<Error>",copyLabel:"Copy",yesText:"Yes",noText:"No"}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{translations:()=>translations});const shared_step1="Etape 1:",shared_step2="Etape 2:",shared_chrome1="Cliquez sur le bouton à gauche de la barre d'adresse",shared_chrome2="Sur la permission Notifications, cliquez sur Autoriser",shared_firefox1="Cliquez sur le bouton bulle à gauche de la barre d'adresse",shared_firefox2='Cliquez sur la croix [x] à côté de "Bloqué"',translations={popin:{title:"Recevoir les notifications",btnSub:"Je m'abonne",btnUnsub:"Ne plus recevoir",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2,safari1:"Cliquer sur Safari > Preferences dans le menu",safari2:"Dans Notifications, choisir Autoriser pour ce site"},button:{hover:"Gérer les notifications "},banner:{text:"Ne ratez plus jamais une nouveauté !",btnSub:"Je m'abonne",btnUnsub:"Ne plus recevoir",title:"Reactiver les notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},alert:{text:"Ne ratez plus jamais une nouveauté !",positiveSubBtnLabel:"Je m'abonne",positiveUnsubBtnLabel:"Ne plus recevoir",negativeBtnLabel:"Non merci",title:"Reactiver les notifications",step1:shared_step1,step2:shared_step2,chrome1:shared_chrome1,chrome2:shared_chrome2,firefox1:shared_firefox1,firefox2:shared_firefox2},"public-identifiers":{titleLabel:"Batch SDK - Identifiants",isRegisteredLabel:"Est abonné aux notifications ?",closeLabel:"Fermer",loadingText:"Chargement...",noValueText:"<Aucune valeur>",errorText:"<Erreur>",copyLabel:"Copier",yesText:"Oui",noText:"Non"}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{UIComponentState:()=>UIComponentState,UIComponent:()=>UIComponent,UIComponentHandler:()=>UIComponentHandler});var com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),com_batch_shared_batch_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31),com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(21),com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(24),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4),_dom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(42);const publicComponents=["button","banner","switcher","popin","alert","native"],privateComponents=["public-identifiers"],baseComponentUrl=com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.IS_DEV?"".concat(document.location.origin,"/"):"https://".concat(com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.SSL_SCRIPT_URL,"/").concat(com_batch_shared_config__WEBPACK_IMPORTED_MODULE_0__.SDK_VERSION,"/");let UIComponentState;!function(UIComponentState){UIComponentState[UIComponentState.UNKNOWN=0]="UNKNOWN",UIComponentState[UIComponentState.LOADING=1]="LOADING",UIComponentState[UIComponentState.LOADED=2]="LOADED"}(UIComponentState||(UIComponentState={}));class UIComponent{constructor(code,initFunction){this.code=code,this.initFunction=initFunction,this.promise=null,this.component=null,this.success=!1}ready(){return null!=this.component}initialized(){return null!=this.promise}intializing(){return this.initialized()&&!this.ready()}init(conf){if(this.initialized()&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.warn("ui-component-handler","The module is already initialized",this.code),this.promise instanceof Promise))return this.promise;com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.debug("ui-component-handler","Init component",this.code);const res=this.initFunction(conf),prom=res instanceof Promise?res:Promise.resolve(res);return this.promise=prom.then(r=>(this.success=!0,this.component=null==r?{}:r)).catch(e=>(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.warn("ui-component-handler","Error while initializing the component",this.code,e),this.success=!1,this.component={})),this.promise.then(()=>{this.success&&com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__.LocalEventBus.emit(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__.default.UiComponentReady,{code:this.code,component:this.component},!1)}),this.promise}}class UIComponentHandler{constructor(){this.components=new Map,this.loadingComponents=new Set,this.config=null,com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__.LocalEventBus.subscribe(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__.default.HashChanged,this.onHashChanged.bind(this))}onHashChanged(args){"#_batchsdk_show_identifiers"===args.hash&&this.showPublicIdentifiers()}add(code,initFunction){if(this.getComponentState(code)==UIComponentState.LOADED)throw new com_batch_shared_batch_error__WEBPACK_IMPORTED_MODULE_1__.default("The component "+code+" already exists");this.loadingComponents.delete(code);const component=new UIComponent(code,initFunction);return com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_4__.Log.info("ui-component-handler","Add new component",code),this.components.set(code,component),null!=this.config&&component.init(this.config[code]||{}),component}getComponent(code){return this.components.get(code)||null}getComponentState(code){return this.loadingComponents.has(code)?UIComponentState.LOADING:this.components.get(code)?UIComponentState.LOADED:UIComponentState.UNKNOWN}shouldLoadComponent(code){return this.getComponentState(code)==UIComponentState.UNKNOWN}isKnownComponent(code){return-1!==publicComponents.indexOf(code)||-1!==privateComponents.indexOf(code)}isPublicComponent(code){return-1!==publicComponents.indexOf(code)}loadNativeComponentScript(code){if(!this.shouldLoadComponent(code))return Promise.reject("Refusing to load component ".concat(code,": it is already loaded or is loading."));if(!this.isKnownComponent(code))return Promise.reject("Refusing to load component ".concat(code,": it is not part of the known loadable components"));const url="".concat(baseComponentUrl).concat(code,".min.js");return new Promise((resolve,reject)=>{const tag=document.createElement("script");tag.async=!0,tag.src=url,tag.onload=()=>resolve(!0),tag.onerror=()=>{this.loadingComponents.delete(code),reject("Loading error")},_dom__WEBPACK_IMPORTED_MODULE_5__.doc.getByTag("script").first().before(tag,!1).empty()?reject(new Error("Unable to insert the script "+url)):this.loadingComponents.add(code)})}autoLoadNativeComponents(config){const loadingPromises=Object.keys(config).filter(code=>this.isPublicComponent(code)).map(componentCode=>this.loadNativeComponentScript(componentCode));return Promise.all(loadingPromises).then(()=>Promise.resolve())}async showPublicIdentifiers(){try{await this.loadNativeComponentScript("public-identifiers")}catch(_unused){}(await this.waitUntilDrawn("public-identifiers")).show(!0)}waitUntilDrawn(componentCode){return new Promise(resolve=>{com_batch_shared_local_event_bus__WEBPACK_IMPORTED_MODULE_2__.LocalEventBus.subscribe(com_batch_shared_local_sdk_events__WEBPACK_IMPORTED_MODULE_3__.default.UiComponentDrawn,data=>{data.code===componentCode&&data.component&&resolve(data.component)})})}init(config){return this.config=config,this.autoLoadNativeComponents(config).then(()=>{const promises=[];return this.components.forEach((value,key)=>{value.initialized()||promises.push(value.init(config[key]||{}))}),Promise.all(promises)})}}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DOMElement:()=>DOMElement,dom:()=>dom,doc:()=>doc});var _size__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(43);const realHTMLElementPrototype=Object.getPrototypeOf(Object.getPrototypeOf(document.createElement("span")));function isHTMLElement(e){return Object.prototype.isPrototypeOf.call(realHTMLElementPrototype,Object.getPrototypeOf(e))}class DOMElement{constructor(elems){this.wrapped=elems}toArray(){return null!=this.doms||(this.doms=this.wrapped.map(e=>DOMElement.from(e))),this.doms}filterHTML(){return this.wrapped.filter(isHTMLElement)}filterSVG(){return this.wrapped.filter(e=>e instanceof SVGElement)}elem(){return this.wrapped[0]}elems(){return this.wrapped}is(d){const e=this.elem();return void 0!==e&&0!==d.length()&&d.someElem(el=>el===e)}concat(d){return new DOMElement(this.wrapped.concat(d.wrapped))}getById(id){return DOMElement.from(document.getElementById(id))}selectOne(selector){const a=this.wrapped.map(e=>e.querySelector(selector));return DOMElement.from(a.filter(e=>null!=e))}select(selector){const a=DOMElement.flattern(this.wrapped.map(e=>e.querySelectorAll(selector)));return DOMElement.from(a)}getByTag(tag){const a=DOMElement.flattern(this.wrapped.map(e=>e.getElementsByTagName(tag)));return DOMElement.from(a)}getByClass(className){const a=DOMElement.flattern(this.wrapped.map(e=>e.getElementsByClassName(className)));return DOMElement.from(a)}parent(){return DOMElement.from(this.wrapped.map(e=>e.parentElement).filter(e=>null!=e))}closest(selector){return DOMElement.from(this.wrapped.map(e=>e.closest(selector)).filter(e=>null!=e))}empty(){return 0===this.wrapped.length}length(){return this.wrapped.length}first(){return DOMElement.from(null!=this.doms?this.doms[0]:this.wrapped[0])}last(){return DOMElement.from(null!=this.doms?this.doms[this.wrapped.length-1]:this.wrapped[this.wrapped.length-1])}forEach(callback){return this.toArray().forEach(callback),this}forEachElem(callback){return this.wrapped.forEach(callback),this}filter(callback){return DOMElement.from(this.toArray().filter(callback).map(e=>e.elem()))}filterElem(callback){return this.wrapped.filter(callback)}some(callback){return this.toArray().some(callback)}someElem(callback){return this.wrapped.some(callback)}hasClass(className){return this.filterHTML().some(e=>e.className.split(" ").some(c=>c===className))}addClass(className){return null!==className&&this.filterHTML().forEach(e=>{e.className+=" "+className}),this}removeClass(className){return null!==className&&this.filterHTML().forEach(e=>{e.className=e.className.split(" ").filter(c=>c!==className).join(" ")}),this}html(content){return null!==content&&this.filterHTML().forEach(e=>e.innerHTML=content),this}text(content){return null!==content&&this.filterHTML().forEach(e=>{e instanceof HTMLInputElement?e.value=content:e.innerText=content}),this}placeholder(content){return null!==content&&this.filterHTML().forEach(e=>{e instanceof HTMLInputElement?e.placeholder=content:e.innerText=content}),this}listenTo(evt,callback){return null!=evt&&null!=callback&&this.wrapped.forEach(e=>e.addEventListener(evt,callback)),this}style(st){return this.filterHTML().forEach(e=>{Object.keys(st).forEach(k=>e.style[k]=st[k])}),this}styleProperty(st){return"function"==typeof CSSStyleDeclaration.prototype.setProperty&&this.filterHTML().forEach(e=>{Object.keys(st).forEach(k=>e.style.setProperty(k,st[k]))}),this}styleSVG(st){return this.filterSVG().forEach(e=>{Object.keys(st).forEach(k=>e.style[k]=st[k])}),this}rect(){const e=this.elem();return null==e?new _size__WEBPACK_IMPORTED_MODULE_0__.Rectangle(new _size__WEBPACK_IMPORTED_MODULE_0__.Position(0,0),new _size__WEBPACK_IMPORTED_MODULE_0__.Dimension(0,0)):(0,_size__WEBPACK_IMPORTED_MODULE_0__.sizeOfElement)(e)}dim(){const e=this.elem();return void 0===e?new _size__WEBPACK_IMPORTED_MODULE_0__.Dimension(0,0):(0,_size__WEBPACK_IMPORTED_MODULE_0__.sizeOfElement)(e).dim}isFixed(){let e=this.elem();for(;e&&!(e instanceof HTMLElement);)e=e.parentElement;if(null==e)return!1;for(;null!=e;){if("fixed"===window.getComputedStyle(e).position)return!0;e=e.offsetParent}return!1}before(newElem,clone){const a=this.wrapped.map(e=>null!=e.parentNode?e.parentNode.insertBefore(clone?newElem.cloneNode(!0):newElem,e):null);return DOMElement.from(a.filter(e=>null!=e))}append(newElem,clone){const a=this.wrapped.map(e=>e.appendChild(clone?newElem.cloneNode(!0):newElem));return DOMElement.from(a.filter(e=>null!=e))}prepend(newElem,clone){const a=this.wrapped.map(e=>{const ne=clone?newElem.cloneNode(!0):newElem;if("function"==typeof e.prepend)e.prepend(ne);else{const docFrag=document.createDocumentFragment();docFrag.appendChild(ne instanceof Node?ne:document.createTextNode(String(ne))),e.insertBefore(docFrag,e.firstChild)}return ne});return DOMElement.from(a.filter(e=>null!=e))}static flattern(a){return 0===a.length?[]:a.reduce((acc,val)=>acc.concat(Array.from(val)),[])}static from(ne){if(null==ne)return DOMElement.EMPTY;const e=ne;if("string"==typeof e)return DOMElement.from(document.querySelectorAll(e));if("object"==typeof e){if(e instanceof Array||e instanceof NodeList){const elements=[];for(let i=0;i<e.length;i++){const node=e[i];node instanceof Element&&elements.push(node)}return new DOMElement(elements)}if(e instanceof DOMElement)return e;if(e instanceof Element)return new DOMElement([e]);if(e instanceof HTMLCollection)return new DOMElement(Array.from(e))}return DOMElement.EMPTY}}var obj,key,value;function dom(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(0===args.length)return DOMElement.EMPTY;if(1===args.length)return DOMElement.from(args[0]);let d=DOMElement.EMPTY;return args.forEach(e=>d=d.concat(DOMElement.from(e))),d}obj=DOMElement,key="EMPTY",value=new DOMElement([]),key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;const doc={getById:id=>dom(document.getElementById(id)),getByTag:tag=>dom(document.getElementsByTagName(tag)),getByClass:className=>dom(document.getElementsByClassName(className)),selectOne:selector=>dom(document.querySelector(selector)),select:selector=>dom(document.querySelectorAll(selector)),body:()=>dom(document.body)}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Position:()=>Position,Dimension:()=>Dimension,Rectangle:()=>Rectangle,screenPos:()=>screenPos,screenDim:()=>screenDim,windowDim:()=>windowDim,windowBox:()=>windowBox,fromClientRect:()=>fromClientRect,sizeOfElement:()=>sizeOfElement});class Position{constructor(left,top){this.left=left,this.top=top}toString(){return"left="+this.left+"px,top="+this.top+"px"}asStyle(){return{left:this.left+"px",top:this.top+"px"}}}class Dimension{constructor(width,height){this.width=width,this.height=height}centerIn(box){const dim=box.dim,pos=box.pos,l=this.width<dim.width?dim.width/2-this.width/2:0,t=this.height<dim.height?dim.height/2-this.height/2:0;return new Position(l+pos.left,t+pos.top)}toString(){return"width="+this.width+"px,height="+this.height+"px"}}class Rectangle{constructor(pos,dim){this.pos=pos,this.dim=dim}toString(){return this.pos.toString()+","+this.dim.toString()}top(){return this.pos.top}left(){return this.pos.left}right(){return this.pos.left+this.dim.width}bottom(){return this.pos.top+this.dim.height}width(){return this.dim.width}height(){return this.dim.height}}function screenPos(){return void 0===window.screenLeft||void 0===window.screenTop?new Position(window.screenX,window.screenY):new Position(window.screenLeft,window.screenTop)}function screenDim(){return new Dimension(screen.width,screen.height)}function windowDim(){if(window.innerWidth||window.innerHeight)return new Dimension(window.innerWidth,window.innerHeight);if(null!=document.documentElement){const el=document.documentElement;if(el.clientWidth&&el.clientHeight)return new Dimension(el.clientWidth,el.clientHeight)}return screenDim()}function windowBox(){return new Rectangle(screenPos(),windowDim())}function fromClientRect(rect){const pos=new Position(rect.left,rect.top),dim=new Dimension(rect.right-rect.left,rect.bottom-rect.top);return new Rectangle(pos,dim)}function sizeOfElement(element){return fromClientRect(element.getBoundingClientRect())}},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function deepClone(src){const source=src;if("object"!=typeof source)return source;if(null==source)return null;if(source instanceof Date)return new Date(source);if(source instanceof Array){const outArray=[];for(let i=0;i<source.length;i++)outArray[i]=deepClone(source[i]);return outArray}if(source instanceof Object){const outObject={};for(const prop in source)Object.prototype.hasOwnProperty.call(source,prop)&&(outObject[prop]=deepClone(source[prop]));return outObject}return source}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>deepClone})}],__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{__webpack_require__.r(__webpack_exports__);var com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_public_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6);com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.name="MSDK",_config__WEBPACK_IMPORTED_MODULE_1__.IS_DEV&&(com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.level=com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.LogLevel.Debug,com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.enableModule("*"),com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.disableModule("local-bus"));!function(w){const api=(0,_public_api__WEBPACK_IMPORTED_MODULE_2__.default)();function execute(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(0===args.length)return void com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","No arguments given");let mArgs=null;args[0]instanceof Array&&(mArgs=args[0],args=args.slice(1));let result,callback=null;if(args.length>0&&("function"==typeof args[0]?(args.length>1&&com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","No arguments expected after a callback"),callback=args[0]):null==mArgs&&(mArgs=args)),null!=mArgs)if("string"!=typeof mArgs[0])com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","No message name given");else{const message=mArgs[0];let msg=message,who=api;mArgs=mArgs.slice(1),msg.startsWith("ui.")&&(msg=msg.substring(3),who=api.ui),who[msg]?result=who[msg].apply(api,mArgs):com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","Unknown message",message)}callback&&callback(api,result)}const queue=w.batchSDK&&w.batchSDK.q||[];if(Array.isArray(queue)){let job;for(w.batchSDK=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return queue.push(args)};job=queue.shift();)execute.apply(w,job);w.batchSDK=function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return execute.apply(w,args)}}const devToolApi=w["_com.batchsdk.web.devtool.api"];if(devToolApi){com_batch_shared_logger__WEBPACK_IMPORTED_MODULE_0__.Log.warn("boostrap","Enabling devtool support");const oldSDK=w.batchSDK;"function"==typeof devToolApi.sdkCalled&&(w.batchSDK=function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];devToolApi.sdkCalled.apply(w,args),oldSDK.apply(w,args)}),"function"==typeof devToolApi.setSdkApi&&devToolApi.setSdkApi((function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];oldSDK.apply(w,args)})),"function"==typeof devToolApi.sdkLoaded&&devToolApi.sdkLoaded()}}(window)})()})();